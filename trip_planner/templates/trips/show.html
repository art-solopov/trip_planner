{% extends "base.html" %}
{% from "macros/icon.html" import icon %}

{% block main %}
    <div class="trip-map" id="map" data-map-target="map" aria-label="Map"></div>
    <div class="app">
        <header>
            <div class="d-flex align-items-center">
                <h1>{{ trip.name }}</h1>
                <div class="ms-auto">
                    <a href="{{ url_for('.update', slug=trip.slug) }}" class="btn btn-secondary" title="Edit">{{ icon('pencil') }}</a>
                    <a href="{{ url_for('.delete_trip', slug=trip.slug) }}" class="btn btn-danger" title="Delete">{{ icon('bin2') }}</a>
                </div>
            </div>
            <!-- <div>Count: {{ points_count }}</div> -->

            <div>
                <a href="{{ url_for('.add_point', slug=trip.slug) }}" class="btn btn-small btn-success" title="Add point">{{ icon('plus') }} Add point</a>
            </div>

            <div class="btn-group" role="group" aria-label="Trip controls">
            </div>
        </header>

        {%- for g_type, pts in points %}
            <section class="trip-point-items trip-points--{{ g_type | lower }}">
                <h2 class="h4">{{ g_type | capitalize }}</h2>
                <ul class="">
                    {%- for point in pts %}
                        <li class="trip-point-item"
                            id="{{ point.id }}"
                            data-map-target="point"
                            data-lat="{{ point.lat }}"
                            data-lon="{{ point.lon }}"
                            data-category="{{ point.type }}">
                            <div>
                                <h3 class="h5 item-name">{{ point.name }}</h3>
                                <p class="item-address">{{ point.address }}</p>
                            </div>
                            <div class="item-links btn-group" role="group" aria-label="Point controls">
                                <a class="btn btn-small btn-secondary pan-link" href="#" title="Center map" data-action="click->map#panTo">{{ icon('compass2') }}</a>
                                <a class="btn btn-small btn-primary more-link" href="{{ url_for('.show_point', slug=trip.slug, id=point.id) }}" title="More">{{ icon('file-text2') }}</a>
                                <a class="btn btn-small btn-info edit-link" href="{{ url_for('.update_point', slug=trip.slug, id=point.id) }}" title="Edit">{{ icon('pencil') }}</a>
                                <a class="btn btn-small btn-danger delete-link" href="{{ url_for('.delete_point', slug=trip.slug, id=point.id ) }}" title="Delete">{{ icon('bin2') }}</a>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </section>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_head %}
    {# TODO: maybe install via npm #}
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css' rel='stylesheet' />
    {# TODO: maybe join with app.css? #}
    {{ style_tag('trip_show') }}
{% endblock %}

{% block extra_body %}
    {{ script_tag('trip_show') }}
{% endblock %}
